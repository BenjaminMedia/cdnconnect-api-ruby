<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: CDNConnect::APIClient
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../CDNConnect.html" title="CDNConnect (module)">CDNConnect</a></span></span>
     &raquo; 
    <span class="title">APIClient</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: CDNConnect::APIClient
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">CDNConnect::APIClient</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/cdnconnect_api.rb</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="application_name-classvariable" class="">@@application_name =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cdnconnect-api-ruby</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="application_version-classvariable" class="">@@application_version =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.1</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="api_host-classvariable" class="">@@api_host =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://api.cdnconnect.com</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="user_agent-classvariable" class="">@@user_agent =
          
        </dt>
        <dd><pre class="code"><span class='cvar'>@@application_name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> v</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='cvar'>@@application_version</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#access_token-instance_method" title="#access_token (instance method)">- (Object) <strong>access_token</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#client_id-instance_method" title="#client_id (instance method)">- (Object) <strong>client_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#client_secret-instance_method" title="#client_secret (instance method)">- (Object) <strong>client_secret</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#code-instance_method" title="#code (instance method)">- (Object) <strong>code</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Used to receive information about an object, which can be either a file or 
folder.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (APIClient) <strong>initialize</strong>(options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a client to authorize interactions with the API using the OAuth 2.0
protocol.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#redirect_uri-instance_method" title="#redirect_uri (instance method)">- (Object) <strong>redirect_uri</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#response_format-instance_method" title="#response_format (instance method)">- (Object) <strong>response_format</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#scope-instance_method" title="#scope (instance method)">- (Object) <strong>scope</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#state-instance_method" title="#state (instance method)">- (Object) <strong>state</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload-instance_method" title="#upload (instance method)">- (Object) <strong>upload</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Used to upload a file or files within a folder to a destination folder
within a CDN Connect app.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="CDNConnect::APIClient (class)">APIClient</a></span></tt>) <strong>initialize</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a client to authorize interactions with the API using the OAuth 2.0
protocol. This can be given a known API Key (access_token) or can use OAuth
2.0  web application flow designed for 3rd party web sites (clients).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The configuration parameters for the client.</p>
<ul><li>
<p><code>:api_key</code> - An API Key (commonly known as an access_token)
which was previously  created within CDN Connect&#39;s account for a
specific app.</p>
</li><li>
<p><code>:response_format</code> - How data should be formatted on the
response. Possible values for include application/json, application/xml.
JSON is the default.</p>
</li><li>
<p><code>:client_id</code> - A unique identifier issued to the client to
identify itself to CDN Connect&#39;s authorization server. This is issued
by CDN Connect to individual clients.</p>
</li><li>
<p><code>:client_secret</code> - A shared secret issued by the CDN
Connect&#39;s authorization server, which is used to authenticate the
client. Do not confuse this is an access_token or an api_key.</p>
</li><li>
<p><code>:scope</code> - The scope of the access request, expressed either as
an Array or as a space-delimited String.</p>
</li><li>
<p><code>:state</code> - An unguessable random string designed to allow the
client to maintain state to protect against cross-site request forgery
attacks.</p>
</li><li>
<p><code>:code</code> - The authorization code received from the authorization
server.</p>
</li><li>
<p><code>:redirect_uri</code> - The redirection URI used in the initial
request.</p>
</li><li>
<p><code>:access_token</code> - The current access token for this client, also
known as the API Key.</p>
</li></ul>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='comment'># Normalize key to String to allow indifferent access.
</span>  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_accu'>accu</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span><span class='op'>|</span> <span class='id identifier rubyid_accu'>accu</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='semicolon'>;</span> <span class='id identifier rubyid_accu'>accu</span> <span class='rbrace'>}</span>
  
  <span class='comment'># Initialize all of the options
</span>  <span class='ivar'>@client_id</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>client_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@client_secret</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>client_secret</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@scope</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scope</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@state</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>state</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@code</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>code</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@redirect_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redirect_uri</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>access_token</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>access_token</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>api_key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='comment'># both work
</span>  <span class='ivar'>@access_token</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>access_token</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@response_format</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>response_format</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/json</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@prefetched_upload_urls</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  
  <span class='comment'># Create the OAuth2 client which will be used to authorize the requests
</span>  <span class='ivar'>@client</span> <span class='op'>=</span> <span class='const'>Signet</span><span class='op'>::</span><span class='const'>OAuth2</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:client_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_client_id'>client_id</span><span class='comma'>,</span>
                                       <span class='symbol'>:client_secret</span> <span class='op'>=&gt;</span> <span class='ivar'>@client_secret</span><span class='comma'>,</span>
                                       <span class='symbol'>:scope</span> <span class='op'>=&gt;</span> <span class='ivar'>@scope</span><span class='comma'>,</span>
                                       <span class='symbol'>:state</span> <span class='op'>=&gt;</span> <span class='ivar'>@state</span><span class='comma'>,</span>
                                       <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='ivar'>@code</span><span class='comma'>,</span>
                                       <span class='symbol'>:redirect_uri</span> <span class='op'>=&gt;</span> <span class='ivar'>@redirect_uri</span><span class='comma'>,</span>
                                       <span class='symbol'>:access_token</span> <span class='op'>=&gt;</span> <span class='ivar'>@access_token</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="access_token-instance_method">
  
    - (<tt>Object</tt>) <strong>access_token</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


379
380
381</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 379</span>

<span class='kw'>def</span> <span class='id identifier rubyid_access_token'>access_token</span>
  <span class='ivar'>@access_token</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="client_id-instance_method">
  
    - (<tt>Object</tt>) <strong>client_id</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


355
356
357</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 355</span>

<span class='kw'>def</span> <span class='id identifier rubyid_client_id'>client_id</span>
  <span class='ivar'>@client_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="client_secret-instance_method">
  
    - (<tt>Object</tt>) <strong>client_secret</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


359
360
361</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 359</span>

<span class='kw'>def</span> <span class='id identifier rubyid_client_secret'>client_secret</span>
  <span class='ivar'>@client_secret</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="code-instance_method">
  
    - (<tt>Object</tt>) <strong>code</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


371
372
373</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 371</span>

<span class='kw'>def</span> <span class='id identifier rubyid_code'>code</span>
  <span class='ivar'>@code</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Used to receive information about an object, which can be either a file or 
folder. This method requires either a CDN Connect URL, or both an app_id
and obj_id.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The configuration parameters for the client.</p>
<ul><li>
<p><code>:url</code> - The URL of the object to get data on. If the URL option
is not provided then you must use the app_id and obj_id options.</p>
</li><li>
<p><code>:app_id</code> - The app_id of the object to get data on. If the
app_id or obj_id options  are not provided then you must use the url
option.</p>
</li><li>
<p><code>:obj_id</code> - The obj_id of the object to get data on. If the
app_id or obj_id options  are not provided then you must use the url
option.</p>
</li></ul>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 106</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generate_obj_path'>generate_obj_path</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="redirect_uri-instance_method">
  
    - (<tt>Object</tt>) <strong>redirect_uri</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


375
376
377</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 375</span>

<span class='kw'>def</span> <span class='id identifier rubyid_redirect_uri'>redirect_uri</span>
  <span class='ivar'>@redirect_uri</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="response_format-instance_method">
  
    - (<tt>Object</tt>) <strong>response_format</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


383
384
385</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 383</span>

<span class='kw'>def</span> <span class='id identifier rubyid_response_format'>response_format</span>
  <span class='ivar'>@response_format</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="scope-instance_method">
  
    - (<tt>Object</tt>) <strong>scope</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


363
364
365</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 363</span>

<span class='kw'>def</span> <span class='id identifier rubyid_scope'>scope</span>
  <span class='ivar'>@scope</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="state-instance_method">
  
    - (<tt>Object</tt>) <strong>state</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


367
368
369</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 367</span>

<span class='kw'>def</span> <span class='id identifier rubyid_state'>state</span>
  <span class='ivar'>@state</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload-instance_method">
  
    - (<tt>Object</tt>) <strong>upload</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Used to upload a file or files within a folder to a destination folder
within a CDN Connect app. This method requires either a CDN Connect URL, or
both an app_id and obj_id. If you are uploading many files be sure to use
the same client instance.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The configuration parameters for the client.</p>
<ul><li>
<p><code>:destination_folder_url</code> - The URL of the folder to upload to.
If the destination folder URL option  is not provided then you must use the
app_id and obj_id options.</p>
</li><li>
<p><code>:app_id</code> - The app_id of the app to upload to. If the app_id or
obj_id options  are not provided then you must use the url option.</p>
</li><li>
<p><code>:obj_id</code> - The obj_id of the folder to upload to. If the app_id
or obj_id options  are not provided then you must use the url option.</p>
</li><li>
<p><code>:source_file_local_path</code> - A string of a source file&#39;s
local paths to upload.</p>
</li></ul>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cdnconnect_api.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upload'>upload</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='comment'># Make sure we&#39;ve got good data before starting the upload
</span>  <span class='id identifier rubyid_prepare_upload'>prepare_upload</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='kw'>begin</span>

    <span class='comment'># Check if we have a prefetched upload url before requesting a new one
</span>    <span class='id identifier rubyid_upload_url'>upload_url</span> <span class='op'>=</span> <span class='id identifier rubyid_get_prefetched_upload_url'>get_prefetched_upload_url</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:destination_folder_url</span><span class='rbracket'>]</span><span class='comma'>,</span> 
                                           <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:app_id</span><span class='rbracket'>]</span><span class='comma'>,</span> 
                                           <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:obj_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_upload_url'>upload_url</span> <span class='op'>==</span> <span class='kw'>nil</span>
      <span class='comment'># We do not already have an upload url created. The first upload request
</span>      <span class='comment'># will need to make a request for an upload url. After the first upload
</span>      <span class='comment'># each upload response will also include a new upload url which can be used 
</span>      <span class='comment'># for the next upload when uploading to the same folder.
</span>      <span class='id identifier rubyid_upload_url_response'>upload_url_response</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_upload_url'>get_upload_url</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_upload_url_response'>upload_url_response</span><span class='period'>.</span><span class='id identifier rubyid_is_error'>is_error</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_upload_url_response'>upload_url_response</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_upload_url'>upload_url</span> <span class='op'>=</span> <span class='id identifier rubyid_upload_url_response'>upload_url_response</span><span class='period'>.</span><span class='id identifier rubyid_get_result'>get_result</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>upload_url</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Create the POST data that gets sent in the request
</span>    <span class='id identifier rubyid_post_data'>post_data</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_post_data'>post_data</span><span class='lbracket'>[</span><span class='symbol'>:create_upload_url</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># have the API also create the next upload url
</span>    <span class='id identifier rubyid_post_data'>post_data</span><span class='lbracket'>[</span><span class='symbol'>:file</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Faraday</span><span class='op'>::</span><span class='const'>UploadIO</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source_file_local_path</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mime_type</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># Build the request to the API
</span>    <span class='id identifier rubyid_conn'>conn</span> <span class='op'>=</span> <span class='const'>Faraday</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req'>req</span><span class='op'>|</span>
      <span class='comment'># https://github.com/lostisland/faraday
</span>      <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>User-Agent</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='cvar'>@@user_agent</span>
      <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Authorization</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Bearer </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='ivar'>@access_token</span>
      <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span> <span class='symbol'>:multipart</span>
      <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_adapter'>adapter</span> <span class='symbol'>:net_http</span>
    <span class='kw'>end</span>

    <span class='comment'># Kick it off!
</span>    <span class='id identifier rubyid_api_response'>api_response</span> <span class='op'>=</span> <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_post'>post</span> <span class='id identifier rubyid_upload_url'>upload_url</span><span class='comma'>,</span> <span class='id identifier rubyid_post_data'>post_data</span>

    <span class='comment'># Woot! Convert the response to our model and see what&#39;s up
</span>    <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='const'>APIResponse</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_api_response'>api_response</span><span class='rparen'>)</span>

    <span class='comment'># an upload response also contains a new upload url. Save it for the next upload.
</span>    <span class='id identifier rubyid_set_prefetched_upload_url'>set_prefetched_upload_url</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:destination_folder_url</span><span class='rbracket'>]</span><span class='comma'>,</span> 
                              <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:app_id</span><span class='rbracket'>]</span><span class='comma'>,</span> 
                              <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:obj_id</span><span class='rbracket'>]</span><span class='comma'>,</span>
                              <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_result'>get_result</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>upload_url</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='comment'># Rettempt the upload a max of two times if there was a server error
</span>    <span class='comment'># Otherwise return the response data
</span>    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_is_server_error'>is_server_error</span> <span class='kw'>or</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&gt;</span> <span class='int'>2</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_response'>response</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span> <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;=</span> <span class='int'>3</span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Mar 12 19:52:05 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>